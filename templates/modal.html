<!-- Modal Add Product -->
<div id="addProductModal"
    class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 backdrop-blur-sm">
    <div id="addProductModalContent"
        class="bg-white rounded-2xl shadow-2xl w-5/6 sm:w-3/5 md:w-1/2 lg:w-2/5 xl:w-1/3 max-h-[90vh] flex flex-col transform transition-all duration-300 opacity-0 scale-95 overflow-hidden">

        <!-- Modal header (Fixed) -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-cyan-50 to-cyan-100 flex-shrink-0 rounded-t-2xl">
            <div>
                <h3 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    Add New Product
                </h3>
                <p class="text-sm text-gray-600 mt-1">Add a new football product to your catalog</p>
            </div>
            <button type="button"
                class="text-gray-400 bg-white hover:bg-red-50 hover:text-red-600 rounded-full text-sm w-8 h-8 flex items-center justify-center transition-all duration-200 shadow-sm hover:shadow"
                onclick="hideAddModal()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>

        <!-- Modal body (Scrollable) -->
        <div class="px-6 py-6 space-y-4 bg-gray-50 overflow-y-auto flex-1">
            <form id="productForm" method="POST" action="{% url 'main:add_product' %}">
                {% csrf_token %}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Product Name -->
                    <div class="md:col-span-2">
                        <label for="name" class="block text-sm font-semibold text-gray-700 mb-1.5">Product Name *</label>
                        <input type="text" id="name" name="name" placeholder="e.g., Nike Mercurial Vapor"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Brand -->
                    <div>
                        <label for="brand" class="block text-sm font-semibold text-gray-700 mb-1.5">Brand *</label>
                        <input type="text" id="brand" name="brand" placeholder="e.g., Nike"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Price -->
                    <div>
                        <label for="price" class="block text-sm font-semibold text-gray-700 mb-1.5">Price (Rp) *</label>
                        <input type="number" id="price" name="price" placeholder="0"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Stock -->
                    <div>
                        <label for="stock" class="block text-sm font-semibold text-gray-700 mb-1.5">Stock *</label>
                        <input type="number" id="stock" name="stock" placeholder="0"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Category -->
                    <div>
                        <label for="category" class="block text-sm font-semibold text-gray-700 mb-1.5">Category *</label>
                        <select id="category" name="category"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                            <option value="">Choose a category</option>
                            <option value="clothing">Clothing</option>
                            <option value="ball">Ball</option>
                            <option value="shoes">Shoes</option>
                            <option value="gloves">Gloves</option>
                            <option value="gear">Protective Gear</option>
                            <option value="training">Training Equipment</option>
                            <option value="accessories">Accessories</option>
                        </select>
                    </div>

                    <!-- Size -->
                    <div>
                        <label for="size" class="block text-sm font-semibold text-gray-700 mb-1.5">Size</label>
                        <input type="text" id="size" name="size" placeholder="e.g., M, L, XL"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                    </div>

                    <!-- Color -->
                    <div>
                        <label for="color" class="block text-sm font-semibold text-gray-700 mb-1.5">Color</label>
                        <input type="text" id="color" name="color" placeholder="e.g., Red, Blue"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                    </div>

                    <!-- Thumbnail -->
                    <div class="md:col-span-2">
                        <label for="thumbnail" class="block text-sm font-semibold text-gray-700 mb-1.5">Thumbnail URL</label>
                        <input type="url" id="thumbnail" name="thumbnail" placeholder="https://example.com/image.jpg"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                    </div>

                    <!-- Featured -->
                    <div class="md:col-span-2">
                        <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-cyan-300 transition-colors">
                            <input type="checkbox" id="is_featured" name="is_featured"
                                class="w-5 h-5 text-cyan-600 bg-gray-100 border-gray-300 rounded focus:ring-2 focus:ring-cyan-500">
                            <label for="is_featured" class="ml-3 text-sm font-medium text-gray-900">
                                ⭐ Mark as Featured Product
                            </label>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Modal footer (Fixed) -->
        <div class="flex flex-col sm:flex-row gap-3 p-6 border-t border-gray-200 bg-white flex-shrink-0 rounded-b-2xl">
            <button type="button"
                class="order-2 sm:order-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 text-center"
                onclick="hideAddModal()">
                Cancel
            </button>
            <button type="submit" form="productForm"
                class="order-1 sm:order-2 flex-1 bg-cyan-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-cyan-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                Add Product
            </button>
        </div>
    </div>
</div>

<!-- Modal Edit Product -->
<div id="editProductModal"
    class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 backdrop-blur-sm">
    <div id="editProductModalContent"
        class="bg-white rounded-2xl shadow-2xl w-5/6 sm:w-3/5 md:w-1/2 lg:w-2/5 xl:w-1/3 max-h-[90vh] flex flex-col transform transition-all duration-300 overflow-hidden">

        <!-- Modal header (Fixed) -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-cyan-50 to-cyan-100 flex-shrink-0 rounded-t-2xl">
            <div>
                <h3 class="text-2xl font-bold text-gray-900 flex items-center gap-2" id="editModalTitle">
                    <svg class="w-6 h-6 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Edit Product
                </h3>
                <p class="text-sm text-gray-600 mt-1">Update your product details</p>
            </div>
            <button type="button"
                class="text-gray-400 bg-white hover:bg-red-50 hover:text-red-600 rounded-full text-sm w-8 h-8 flex items-center justify-center transition-all duration-200 shadow-sm hover:shadow"
                onclick="hideEditModal()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>

        <!-- Modal body (Scrollable) -->
        <div class="px-6 py-6 space-y-4 bg-gray-50 overflow-y-auto flex-1">
            <form id="editProductForm">
                {% csrf_token %}
                <input type="hidden" id="editProductId" name="product_id">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Product Name -->
                    <div class="md:col-span-2">
                        <label for="editName" class="block text-sm font-semibold text-gray-700 mb-1.5">Product Name *</label>
                        <input type="text" id="editName" name="name" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Brand -->
                    <div>
                        <label for="editBrand" class="block text-sm font-semibold text-gray-700 mb-1.5">Brand *</label>
                        <input type="text" id="editBrand" name="brand" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Price -->
                    <div>
                        <label for="editPrice" class="block text-sm font-semibold text-gray-700 mb-1.5">Price (Rp) *</label>
                        <input type="number" id="editPrice" name="price" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Stock -->
                    <div>
                        <label for="editStock" class="block text-sm font-semibold text-gray-700 mb-1.5">Stock *</label>
                        <input type="number" id="editStock" name="stock" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                    </div>

                    <!-- Category -->
                    <div>
                        <label for="editCategory" class="block text-sm font-semibold text-gray-700 mb-1.5">Category *</label>
                        <select id="editCategory" name="category" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" required>
                            <option value="">Choose a category</option>
                            <option value="clothing">Clothing</option>
                            <option value="ball">Ball</option>
                            <option value="shoes">Shoes</option>
                            <option value="gloves">Gloves</option>
                            <option value="gear">Protective Gear</option>
                            <option value="training">Training Equipment</option>
                            <option value="accessories">Accessories</option>
                        </select>
                    </div>

                    <!-- Size -->
                    <div>
                        <label for="editSize" class="block text-sm font-semibold text-gray-700 mb-1.5">Size</label>
                        <input type="text" id="editSize" name="size" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                    </div>

                    <!-- Color -->
                    <div>
                        <label for="editColor" class="block text-sm font-semibold text-gray-700 mb-1.5">Color</label>
                        <input type="text" id="editColor" name="color" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                    </div>

                    <!-- Thumbnail -->
                    <div class="md:col-span-2">
                        <label for="editThumbnail" class="block text-sm font-semibold text-gray-700 mb-1.5">Thumbnail URL</label>
                        <input type="url" id="editThumbnail" name="thumbnail" 
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                    </div>

                    <!-- Featured -->
                    <div class="md:col-span-2">
                        <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-cyan-300 transition-colors">
                            <input type="checkbox" id="editIsFeatured" name="is_featured" 
                                class="w-5 h-5 text-cyan-600 bg-gray-100 border-gray-300 rounded focus:ring-2 focus:ring-cyan-500">
                            <label for="editIsFeatured" class="ml-3 text-sm font-medium text-gray-900">
                                ⭐ Mark as Featured Product
                            </label>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Modal footer (Fixed) -->
        <div class="flex flex-col sm:flex-row gap-3 p-6 border-t border-gray-200 bg-white flex-shrink-0 rounded-b-2xl">
            <button type="button" 
                class="order-2 sm:order-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200" 
                onclick="hideEditModal()">
                Cancel
            </button>
            <button type="submit" form="editProductForm" 
                class="order-1 sm:order-2 flex-1 bg-cyan-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-cyan-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                Update Product
            </button>
        </div>
    </div>
</div>

<!-- Modal Delete Product -->
<div id="deleteProductModal" 
    class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 backdrop-blur-sm">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 transform transition-all duration-300 overflow-hidden">
        
        <!-- Modal header (Fixed) -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50 flex-shrink-0 rounded-t-2xl">
            <h3 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
                Delete Product
            </h3>
            <button type="button" 
                class="text-gray-400 bg-white hover:bg-red-50 hover:text-red-600 rounded-full w-8 h-8 flex items-center justify-center transition-all duration-200 shadow-sm hover:shadow" 
                onclick="hideDeleteModal()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>

        <!-- Modal body -->
        <div class="p-6 bg-gray-50">
            <div class="text-center">
                <p class="text-gray-700 text-base mb-3">Are you sure you want to delete this product?</p>
                <div class="bg-white px-4 py-3 rounded-lg border-2 border-red-200 mb-4">
                    <p class="text-lg font-bold text-gray-900" id="deleteProductName"></p>
                </div>
                <p class="text-sm text-red-600 font-medium">This action cannot be undone!</p>
            </div>
            <input type="hidden" id="deleteProductId">
        </div>

        <!-- Modal footer (Fixed) -->
        <div class="flex gap-3 p-6 border-t border-gray-200 bg-white flex-shrink-0 rounded-b-2xl">
            <button type="button" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200" 
                onclick="hideDeleteModal()">
                Cancel
            </button>
            <button type="button" 
                class="flex-1 bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5" 
                onclick="deleteProduct()">
                Delete
            </button>
        </div>
    </div>
</div>

<script>
    function showAddModal() {
        const modal = document.getElementById('addProductModal');
        const content = document.getElementById('addProductModalContent');
        modal.classList.remove('hidden');
        setTimeout(() => {
            content.classList.remove('opacity-0', 'scale-95');
            content.classList.add('opacity-100', 'scale-100');
        }, 50);
    }

    function hideAddModal() {
        const modal = document.getElementById('addProductModal');
        const content = document.getElementById('addProductModalContent');
        content.classList.remove('opacity-100', 'scale-100');
        content.classList.add('opacity-0', 'scale-95');
        setTimeout(() => modal.classList.add('hidden'), 150);
    }

    document.getElementById("productForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;

        const response = await fetch("{% url 'main:add_product_ajax' %}", {
            method: "POST",
            body: new FormData(form)
        });
        const result = await response.json();

        if(result.status === 'success') {
            form.reset();
            hideAddModal();
            showToast('Success', result.message, 'success');
            document.dispatchEvent(new CustomEvent('productAdded'));
        } else {
            showToast('Error', JSON.stringify(result.errors || result.message), 'error');
        }
    });

    function showEditModal(product) {
        const modal = document.getElementById('editProductModal');
        modal.classList.remove('hidden');

        document.getElementById('editProductId').value = product.id;
        document.getElementById('editName').value = product.name;
        document.getElementById('editBrand').value = product.brand;
        document.getElementById('editPrice').value = product.price;
        document.getElementById('editStock').value = product.stock;
        document.getElementById('editSize').value = product.size || '';
        document.getElementById('editColor').value = product.color || '';
        document.getElementById('editCategory').value = product.category;
        document.getElementById('editThumbnail').value = product.thumbnail || '';
        document.getElementById('editIsFeatured').checked = product.is_featured;
    }

    function hideEditModal() {
        const modal = document.getElementById('editProductModal');
        modal.classList.add('hidden');
    }

    document.getElementById('editProductForm').addEventListener('submit', async function(e){
        e.preventDefault();
        const form = e.target;
        const productId = document.getElementById('editProductId').value;
        const formData = new FormData(form);

        if(!formData.has('is_featured')) formData.append('is_featured', '');

        const response = await fetch(`{% url 'main:edit_product_ajax' 0 %}`.replace('0', productId), {
            method: 'POST',
            headers: { 'X-CSRFToken': formData.get('csrfmiddlewaretoken') },
            body: formData
        });
        const result = await response.json();

        if(result.status === "success") {
            hideEditModal();
            showToast('Success', result.message, 'success');
            document.dispatchEvent(new CustomEvent('productAdded'));
        } else {
            showToast('Error', JSON.stringify(result.errors || result.message), 'error');
        }
    });

    function showDeleteModal(product) {
        const modal = document.getElementById('deleteProductModal');
        modal.classList.remove('hidden');
        document.getElementById('deleteProductId').value = product.id;
        document.getElementById('deleteProductName').textContent = product.name;
    }

    function hideDeleteModal() {
        document.getElementById('deleteProductModal').classList.add('hidden');
    }

    async function deleteProduct() {
        const productId = document.getElementById('deleteProductId').value;
        const response = await fetch(`{% url 'main:delete_product_ajax' 0 %}`.replace('0', productId), {
            method: 'POST',
            headers: { 'X-CSRFToken': '{{ csrf_token }}' }
        });
        const result = await response.json();

        if(result.status === 'success') {
            hideDeleteModal();
            showToast('Success', result.message, 'success');
            document.dispatchEvent(new CustomEvent('productAdded'));
        } else {
            showToast('Error', result.message, 'error');
        }
    }
</script>